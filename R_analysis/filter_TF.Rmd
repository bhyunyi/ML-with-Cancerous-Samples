---
title: "Filtering for Transcription Factors"
author: "Tiffany Tang"
date: "2025-07-17"
output: html_document
---

## Transcription Factor filtering code

In this markdown notebook we will be filtering the reformatted tsv for transcription factors. 


```{r readin}
library(dplyr) # load necessary libraries
library(readr)

# Adjust path variables as needed
# pathBrian <- 
pathTiffany <- "C:\\Users\\tiffa\\OneDrive\\Desktop\\Masters in Bioinformatics\\Transcriptomics\\Final\\transformed_data.tsv"

# load in my data
expr_data <- read_tsv(pathTiffany)
```

## Analysis using limma

Since these are not the raw counts (they have been normalized before processing), we will be using limma to analyze the data.
- DESeq2 requires raw counts

With limma I want the expression matrix to be: 
- rows = genes/transcripts
- columns = samples

So I must reformat the data before this step.

```{r limma_reshape}
# Extract expression values 
# First 3 cols are sample, ID, type, so disregard those

expr_matrix <- as.matrix(expr_data_t[, 4:ncol(expr_data_t)])

rownames(expr_matrix) <- expr_data$ID  # sample IDs as column names

expr_matrix <- t(expr_matrix)  # Now rows = genes, cols = samples

#head(expr_matrix) # just to look

# Alright lets do the meta data
group <- factor(expr_data$type)  # type
design <- model.matrix(~0 + group)  # Model matrix for limma
# +0 removes the intercept, so we get a separate column for each group
design # Just to take a look, looking alright
```

The next step would be to remove low expression data

```{r limma_model}
# load in necessary libraries
library(edgeR)
library(limma)

#used the transposed matrix from earlier
fit <- lmFit(expr_matrix, design)

# Define contrasts, this is based on the groups in the design matrix
contrast_matrix <- makeContrasts(
  Lung_Cancer_vs_Normal = groupLung_Cancer - groupNormal_lung,
  levels = design
)


# Fit contrast
fit2 <- contrasts.fit(fit, contrast_matrix)
fit2 <- eBayes(fit2)

# Get top DE genes
results <- topTable(fit2, adjust="BH", number=Inf)

# View results
head(results)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
